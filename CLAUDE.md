# CLAUDE.md

## 目的
このファイルは、Claude Code の作業方針とプロジェクト固有のルールを示します。

## 判断記録のルール
判断を行った場合は、以下の項目を記録に残してください。
1. 判断内容の要約
2. 検討した代替案
3. 採用しなかった案とその理由
4. 前提条件・仮定・不確実性
5. 他エージェントによるレビュー可否

## プロジェクト概要
- 目的: Discord Developer Change Log を監視し、更新を Discord に通知する
- 主な機能: 変更ログの取得、新規検知、Discord 通知、永続化

## 重要ルール
- 会話と言語: 日本語
- コミットメッセージ: Conventional Commits（説明は日本語）
- コード内コメント: 日本語（JSDoc 形式を推奨）
- エラーメッセージ: 英語
- 日本語と英数字の間には半角スペースを挿入

## 環境のルール
- ブランチ命名: Conventional Branch (`feat/`, `fix/`)
- GitHub リポジトリ調査: 調査が必要な場合は一時ディレクトリにクローンして検索する
- Renovate: Renovate が作成した PR には直接コミット・更新を行わない

## Git Worktree
Git Worktree を使用する場合は以下の構成とする：
```text
.bare/
<ブランチ名>/
```

## コード改修時のルール
- エラーメッセージの先頭に絵文字がある場合は、全体で絵文字を統一する
- TypeScript の `skipLibCheck` の有効化による回避は禁止
- 関数・インターフェースには日本語で docstring を記載する

## 相談ルール
- Codex CLI: 実装レビュー、局所設計、整合性確認
- Gemini CLI: 外部仕様、最新情報確認
- 指摘への対応: 信頼度スコア 50 以上の指摘には必ず対応する

## 開発コマンド
```bash
pnpm install  # 依存関係インストール
pnpm dev      # 開発実行（ウォッチ）
pnpm start    # 実行
pnpm test     # テスト
pnpm lint     # Lint チェック
pnpm fix      # 自動修正
```

## アーキテクチャと主要ファイル
- `src/main.ts`: エントリーポイント。全体のフロー制御
- `src/config.ts`: 設定管理（`@book000/node-utils` を使用）
- `src/crawler.ts`: Discord Developer Change Log のスクレイピング
- `src/notified.ts`: 通知済みログの永続化管理
- `src/utils.ts`: ユーティリティ関数

## テスト
- テストフレームワーク: Jest
- 方針: 新規ユーティリティ関数追加時は必ずテストを追加する

## ドキュメント更新ルール
- コード変更に伴い、README.md や関連するプロンプトファイルを更新する

## 作業チェックリスト

### 新規改修時
1. プロジェクトを理解する
2. 適切なブランチ（最新のリモートに基づく）で作業する
3. 依存関係をインストールする

### コミット・プッシュ前
1. Conventional Commits に従っているか確認（説明は日本語）
2. センシティブな情報（Webhook URL 等）が含まれていないか確認
3. Lint / Format エラーがないか確認
4. 動作確認（テスト実行含む）を行う

### PR 作成前
1. ユーザーからの依頼があるか確認
2. コンフリクトの恐れがないか確認

### PR 作成後
1. PR 本文を日本語で最新の状態に更新する
2. CI の成功を確認する
3. レビュー指摘に対応する
